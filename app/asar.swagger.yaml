openapi: 3.0.0
info:
  title: Asar API
  version: 1.0.0
  description: API documentation for Asar Gold project

servers:
  - url: http://localhost:1000/api/v1
    description: Local Development
  - url: https://api.asarmulticenter.ir/api/v1
    description: Production

tags:
  - name: auth
    description: Authentication via OTP
  - name: categories
    description: Endpoints for retrieving post categories
  - name: articles
    description: Endpoints for retrieving articles (posts)
  - name: remote_config
    description: Remote Configuration

paths:
  /auth/send-otp:
    post:
      tags:
        - auth
      summary: Send OTP code to user
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - phone
              properties:
                phone:
                  type: string
                  example: "09038177456"
      responses:
        "200":
          description: OTP sent successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: integer
                    example: 200
                  message:
                    type: string
                    example: "code sent"
                  code:
                    type: string
                    example: "1234"
        "400":
          description: Too many requests or invalid input
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Code already sent"
  /auth/confirm-code:
    post:
      tags:
        - auth
      summary: Verify OTP code
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - phone
                - code
              properties:
                phone:
                  type: string
                  example: "09038177456"
                code:
                  type: string
                  example: "1234"
      responses:
        "200":
          description: Verified and authenticated
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "authorized"
                  token:
                    type: string
                    example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
                  user:
                    type: object
                    properties:
                      id:
                        type: string
                      firstname:
                        type: string
                      lastname:
                        type: string
                      phone:
                        type: string
                      profile_pic:
                        type: string
                      role:
                        type: string
                      createdAt:
                        type: string
                        format: date-time
        "400":
          description: Invalid or expired code
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Invalid code or phone number"
  /categories:
    get:
      tags:
        - categories
      summary: Get post categories
      description: Returns a list of categories. Use parentId query to get sub-categories.
      parameters:
        - name: lang
          in: query
          required: false
          schema:
            type: string
            example: "fa"
            default: "fa"
          description: Filter by language.
        - name: parentId
          in: query
          required: false
          schema:
            type: string
            format: uuid
          description: Provide a parent ID to fetch its direct sub-categories. Omit for top-level categories.
      responses:
        "200":
          description: List of categories retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CategoriesApiResponse'
  /articles:
    get:
      tags:
        - articles
      summary: Get articles
      description: Returns a paginated list of articles.
      parameters:
        - name: lang
          in: query
          required: false
          schema:
            type: string
            example: "fa"
            default: "fa"
        - name: categoryId
          in: query
          required: false
          schema:
            type: string
            format: uuid
        - name: page
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 10
      responses:
        "200":
          description: List of articles retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ArticleListApiResponse'
  /articles/{id}:
    get:
      tags:
        - articles
      summary: Get single article
      description: Returns details for a specific article.
      parameters:
        - name: id
          in: path
          required: true
          description: Article ID
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Article details retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ArticleApiResponse'
        "404":
          description: Article not found
  /articles/{id}/share:
    post:
      tags:
        - articles
      summary: Increment article share count
      description: Increments the share_count of an article by 1.
      parameters:
        - name: id
          in: path
          required: true
          description: Article ID
          schema:
            type: string
            format: uuid
      requestBody:
        content:
          multipart/form-data:
            schema:
              type: object
      responses:
        "200":
          description: Share count incremented
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: integer
                    example: 200
                  message:
                    type: string
                    example: "Share count incremented"
                  data:
                    type: object
                    properties:
                      share_count:
                        type: integer
                        example: 1
        "404":
          description: Article not found
  /remote_config/splash:
    post:
      tags:
        - remote_config
      summary: Get splash screen remote config
      security:
        - bearerAuth: []
      requestBody:
        content:
          multipart/form-data:
            schema:
              type: object
              properties: {}
      responses:
        "200":
          description: Splash config retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: integer
                    example: 200
                  config:
                    type: object
                    example: { "splash_image_url": "...", "min_version": "1.0.1" }
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Unauthorized"
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  schemas:
    PostCategory:
      type: object
      properties:
        id:
          type: string
          format: uuid
          example: "a1b2c3d4-e5f6-7890-g1h2-i3j4k5l6m7n8"
        name:
          type: string
          example: "اخبار"
        image:
          type: string
          example: "uploads/categories/image.png"
          nullable: true
        lang:
          type: string
          example: "fa"
        is_active:
          type: boolean
          example: true
    CategoriesApiResponse:
      type: object
      properties:
        status:
          type: integer
          example: 200
        data:
          type: object
          properties:
            categories:
              type: array
              items:
                $ref: '#/components/schemas/PostCategory'
        cached:
          type: boolean
          example: false
    Article:
      type: object
      properties:
        id:
          type: string
          format: uuid
          example: "e1f8a0d9-9cba-46cd-9ac0-b72a559f3a6f"
        title:
          type: string
          example: "تیتر مقاله"
        content:
          type: string
          example: "<p>متن <strong>HTML</strong>.</p>"
        image:
          type: string
          example: "uploads/articles/image.png"
          nullable: true
        share_count:
          type: integer
          example: 0
        lang:
          type: string
          example: "fa"
        is_active:
          type: boolean
          example: true
        categoryId:
          type: string
          format: uuid
          example: "a1b2c3d4-e5f6-7890-g1h2-i3j4k5l6m7n8"
        created_at:
          type: string
          format: date-time
          example: "2025-11-11T10:00:00.000Z"
        updated_at:
          type: string
          format: date-time
          example: "2025-11-11T10:00:00.000Z"
        category:
          $ref: '#/components/schemas/PostCategory'
    ArticleApiResponse:
      type: object
      properties:
        status:
          type: integer
          example: 200
        data:
          type: object
          properties:
            article:
              $ref: '#/components/schemas/Article'
        cached:
          type: boolean
          example: false
    PaginationMetadata:
      type: object
      properties:
        total:
          type: integer
          example: 120
        page:
          type: integer
          example: 1
        limit:
          type: integer
          example: 10
        total_pages:
          type: integer
          example: 12
        has_next_page:
          type: boolean
          example: true
        has_prev_page:
          type: boolean
          example: false
    ArticleListApiResponse:
      type: object
      properties:
        status:
          type: integer
          example: 200
        data:
          type: object
          properties:
            articles:
              type: array
              items:
                $ref: '#/components/schemas/Article'
            metadata:
              $ref: '#/components/schemas/PaginationMetadata'
        cached:
          type: boolean
          example: false
security:
  - bearerAuth: []